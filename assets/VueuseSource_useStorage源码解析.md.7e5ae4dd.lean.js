import{_ as n,o as a,c as l,a as p}from"./app.7c6fd316.js";const i=JSON.parse('{"title":"useStorageæºç è§£æ","description":"","frontmatter":{"top":4,"sticky":1000,"sidebar":{"title":"useStorageæºç è§£æ","isTimeLine":true},"title":"useStorageæºç è§£æ","date":"2025-03-31T00:00:00.000Z","tags":["å‰ç«¯","javascript","æºç ","VueUse"],"categories":["å‰ç«¯"]},"headers":[{"level":2,"title":"ä¸€ã€æ ¸å¿ƒåŠŸèƒ½ä¸ç‰¹æ€§","slug":"ä¸€ã€æ ¸å¿ƒåŠŸèƒ½ä¸ç‰¹æ€§","link":"#ä¸€ã€æ ¸å¿ƒåŠŸèƒ½ä¸ç‰¹æ€§","children":[]},{"level":2,"title":"äºŒã€æºç ç»“æ„è§£æï¼ˆåŸºäº vueuse v9.0.0ï¼‰","slug":"äºŒã€æºç ç»“æ„è§£æ-åŸºäº-vueuse-v9-0-0","link":"#äºŒã€æºç ç»“æ„è§£æ-åŸºäº-vueuse-v9-0-0","children":[{"level":3,"title":"1. å‡½æ•°ç­¾å","slug":"_1-å‡½æ•°ç­¾å","link":"#_1-å‡½æ•°ç­¾å","children":[]},{"level":3,"title":"2. æ ¸å¿ƒå®ç°æµç¨‹å›¾","slug":"_2-æ ¸å¿ƒå®ç°æµç¨‹å›¾","link":"#_2-æ ¸å¿ƒå®ç°æµç¨‹å›¾","children":[]},{"level":3,"title":"3. å…³é”®æºç ç‰‡æ®µ","slug":"_3-å…³é”®æºç ç‰‡æ®µ","link":"#_3-å…³é”®æºç ç‰‡æ®µ","children":[]}]},{"level":2,"title":"ä¸‰ã€å…³é”®æŠ€æœ¯ç‚¹è¯¦è§£","slug":"ä¸‰ã€å…³é”®æŠ€æœ¯ç‚¹è¯¦è§£","link":"#ä¸‰ã€å…³é”®æŠ€æœ¯ç‚¹è¯¦è§£","children":[{"level":3,"title":"1. æ™ºèƒ½å­˜å‚¨æ£€æµ‹","slug":"_1-æ™ºèƒ½å­˜å‚¨æ£€æµ‹","link":"#_1-æ™ºèƒ½å­˜å‚¨æ£€æµ‹","children":[]},{"level":3,"title":"2. åºåˆ—åŒ–ç³»ç»Ÿè®¾è®¡","slug":"_2-åºåˆ—åŒ–ç³»ç»Ÿè®¾è®¡","link":"#_2-åºåˆ—åŒ–ç³»ç»Ÿè®¾è®¡","children":[]},{"level":3,"title":"3. æ€§èƒ½ä¼˜åŒ–ç­–ç•¥","slug":"_3-æ€§èƒ½ä¼˜åŒ–ç­–ç•¥","link":"#_3-æ€§èƒ½ä¼˜åŒ–ç­–ç•¥","children":[]}]},{"level":2,"title":"å››ã€ä½¿ç”¨ç¤ºä¾‹å¤§å…¨","slug":"å››ã€ä½¿ç”¨ç¤ºä¾‹å¤§å…¨","link":"#å››ã€ä½¿ç”¨ç¤ºä¾‹å¤§å…¨","children":[{"level":3,"title":"1. åŸºç¡€ä½¿ç”¨","slug":"_1-åŸºç¡€ä½¿ç”¨","link":"#_1-åŸºç¡€ä½¿ç”¨","children":[]},{"level":3,"title":"2. è‡ªå®šä¹‰åºåˆ—åŒ–å™¨","slug":"_2-è‡ªå®šä¹‰åºåˆ—åŒ–å™¨","link":"#_2-è‡ªå®šä¹‰åºåˆ—åŒ–å™¨","children":[]},{"level":3,"title":"3. å¤æ‚æ•°æ®ç»“æ„","slug":"_3-å¤æ‚æ•°æ®ç»“æ„","link":"#_3-å¤æ‚æ•°æ®ç»“æ„","children":[]},{"level":3,"title":"4. é«˜çº§é…ç½®é€‰é¡¹","slug":"_4-é«˜çº§é…ç½®é€‰é¡¹","link":"#_4-é«˜çº§é…ç½®é€‰é¡¹","children":[]}]},{"level":2,"title":"äº”ã€SSR åœºæ™¯å¤„ç†","slug":"äº”ã€ssr-åœºæ™¯å¤„ç†","link":"#äº”ã€ssr-åœºæ™¯å¤„ç†","children":[{"level":3,"title":"1. Nuxt.js é›†æˆç¤ºä¾‹","slug":"_1-nuxt-js-é›†æˆç¤ºä¾‹","link":"#_1-nuxt-js-é›†æˆç¤ºä¾‹","children":[]},{"level":3,"title":"2. æœåŠ¡ç«¯æ•°æ®æ°´åˆ","slug":"_2-æœåŠ¡ç«¯æ•°æ®æ°´åˆ","link":"#_2-æœåŠ¡ç«¯æ•°æ®æ°´åˆ","children":[]}]},{"level":2,"title":"å…­ã€æ€§èƒ½ä¸å®‰å…¨","slug":"å…­ã€æ€§èƒ½ä¸å®‰å…¨","link":"#å…­ã€æ€§èƒ½ä¸å®‰å…¨","children":[{"level":3,"title":"1. æ€§èƒ½ä¼˜åŒ–å»ºè®®","slug":"_1-æ€§èƒ½ä¼˜åŒ–å»ºè®®","link":"#_1-æ€§èƒ½ä¼˜åŒ–å»ºè®®","children":[]},{"level":3,"title":"2. å®‰å…¨å®è·µ","slug":"_2-å®‰å…¨å®è·µ","link":"#_2-å®‰å…¨å®è·µ","children":[]}]},{"level":2,"title":"ä¸ƒã€å®ç°åŸç†æ·±åº¦å‰–æ","slug":"ä¸ƒã€å®ç°åŸç†æ·±åº¦å‰–æ","link":"#ä¸ƒã€å®ç°åŸç†æ·±åº¦å‰–æ","children":[{"level":3,"title":"1. å“åº”å¼åŒæ­¥æœºåˆ¶","slug":"_1-å“åº”å¼åŒæ­¥æœºåˆ¶","link":"#_1-å“åº”å¼åŒæ­¥æœºåˆ¶","children":[]},{"level":3,"title":"2. å­˜å‚¨äº‹ä»¶å¤„ç†","slug":"_2-å­˜å‚¨äº‹ä»¶å¤„ç†","link":"#_2-å­˜å‚¨äº‹ä»¶å¤„ç†","children":[]}]},{"level":2,"title":"å…«ã€å¯¹æ¯”åŸç”Ÿå®ç°ä¼˜åŠ¿","slug":"å…«ã€å¯¹æ¯”åŸç”Ÿå®ç°ä¼˜åŠ¿","link":"#å…«ã€å¯¹æ¯”åŸç”Ÿå®ç°ä¼˜åŠ¿","children":[]},{"level":2,"title":"ä¹ã€æœ€ä½³å®è·µåœºæ™¯","slug":"ä¹ã€æœ€ä½³å®è·µåœºæ™¯","link":"#ä¹ã€æœ€ä½³å®è·µåœºæ™¯","children":[]},{"level":2,"title":"åã€æ³¨æ„äº‹é¡¹","slug":"åã€æ³¨æ„äº‹é¡¹","link":"#åã€æ³¨æ„äº‹é¡¹","children":[]},{"level":2,"title":"åä¸€ã€æ‰©å±•åº”ç”¨","slug":"åä¸€ã€æ‰©å±•åº”ç”¨","link":"#åä¸€ã€æ‰©å±•åº”ç”¨","children":[{"level":3,"title":"1. å®ç°è¿‡æœŸæœºåˆ¶","slug":"_1-å®ç°è¿‡æœŸæœºåˆ¶","link":"#_1-å®ç°è¿‡æœŸæœºåˆ¶","children":[]},{"level":3,"title":"2. å®ç°å­˜å‚¨ç©ºé—´ç›‘æ§","slug":"_2-å®ç°å­˜å‚¨ç©ºé—´ç›‘æ§","link":"#_2-å®ç°å­˜å‚¨ç©ºé—´ç›‘æ§","children":[]}]},{"level":2,"title":"åäºŒã€æ€»ç»“","slug":"åäºŒã€æ€»ç»“","link":"#åäºŒã€æ€»ç»“","children":[]}],"relativePath":"VueuseSource/useStorageæºç è§£æ.md","lastUpdated":1763393448000}'),o={name:"VueuseSource/useStorageæºç è§£æ.md"};function e(t,s,r,c,y,F){return a(),l("div",{"data-pagefind-body":!0},[...s[0]||(s[0]=[p(`<h1 id="vueuse-usestorage-æºç è§£æåŠä½¿ç”¨æŒ‡å—" tabindex="-1">VueUse useStorage æºç è§£æåŠä½¿ç”¨æŒ‡å— <a class="header-anchor" href="#vueuse-usestorage-æºç è§£æåŠä½¿ç”¨æŒ‡å—" aria-hidden="true">#</a></h1><h2 id="ä¸€ã€æ ¸å¿ƒåŠŸèƒ½ä¸ç‰¹æ€§" tabindex="-1">ä¸€ã€æ ¸å¿ƒåŠŸèƒ½ä¸ç‰¹æ€§ <a class="header-anchor" href="#ä¸€ã€æ ¸å¿ƒåŠŸèƒ½ä¸ç‰¹æ€§" aria-hidden="true">#</a></h2><p><code>useStorage</code> æ˜¯ VueUse ä¸­ç”¨äºå®ç°æµè§ˆå™¨å­˜å‚¨ï¼ˆlocalStorage/sessionStorageï¼‰ä¸ Vue å“åº”å¼çŠ¶æ€åŒå‘åŒæ­¥çš„å·¥å…·å‡½æ•°ï¼Œå…·å¤‡ä»¥ä¸‹æ ¸å¿ƒèƒ½åŠ›ï¼š</p><ul><li>ğŸŒ è‡ªåŠ¨ JSON åºåˆ—åŒ–/ååºåˆ—åŒ–</li><li>ğŸ”„ è·¨æ ‡ç­¾é¡µæ•°æ®åŒæ­¥ï¼ˆç›‘å¬ storage äº‹ä»¶ï¼‰</li><li>ğŸ›¡ï¸ SSR å‹å¥½æ”¯æŒ</li><li>ğŸ›ï¸ æ”¯æŒè‡ªå®šä¹‰åºåˆ—åŒ–å™¨</li><li>ğŸ’¾ å­˜å‚¨å¤±è´¥è‡ªåŠ¨é™çº§ï¼ˆå†…å­˜å­˜å‚¨ï¼‰</li><li>âš¡ å“åº”å¼æ•°æ®å®æ—¶åŒæ­¥</li></ul><h2 id="äºŒã€æºç ç»“æ„è§£æ-åŸºäº-vueuse-v9-0-0" tabindex="-1">äºŒã€æºç ç»“æ„è§£æï¼ˆåŸºäº vueuse v9.0.0ï¼‰ <a class="header-anchor" href="#äºŒã€æºç ç»“æ„è§£æ-åŸºäº-vueuse-v9-0-0" aria-hidden="true">#</a></h2><h3 id="_1-å‡½æ•°ç­¾å" tabindex="-1">1. å‡½æ•°ç­¾å <a class="header-anchor" href="#_1-å‡½æ•°ç­¾å" aria-hidden="true">#</a></h3><div class="language-typescript line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#C792EA;">function</span><span style="color:#BABED8;"> </span><span style="color:#82AAFF;">useStorage</span><span style="color:#89DDFF;">&lt;</span><span style="color:#FFCB6B;">T</span><span style="color:#89DDFF;">&gt;(</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#BABED8;font-style:italic;">key</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">string</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#BABED8;font-style:italic;">initialValue</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">MaybeRef</span><span style="color:#89DDFF;">&lt;</span><span style="color:#FFCB6B;">T</span><span style="color:#89DDFF;">&gt;,</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#BABED8;font-style:italic;">storage</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">StorageLike</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">|</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">undefined</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;"> isClient </span><span style="color:#89DDFF;">?</span><span style="color:#BABED8;"> localStorage </span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">undefined,</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#BABED8;font-style:italic;">options</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">UseStorageOptions</span><span style="color:#89DDFF;">&lt;</span><span style="color:#FFCB6B;">T</span><span style="color:#89DDFF;">&gt;</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{}</span></span>
<span class="line"><span style="color:#89DDFF;">):</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">RemovableRef</span><span style="color:#89DDFF;">&lt;</span><span style="color:#FFCB6B;">T</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h3 id="_2-æ ¸å¿ƒå®ç°æµç¨‹å›¾" tabindex="-1">2. æ ¸å¿ƒå®ç°æµç¨‹å›¾ <a class="header-anchor" href="#_2-æ ¸å¿ƒå®ç°æµç¨‹å›¾" aria-hidden="true">#</a></h3><div class="language-mermaid line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">mermaid</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#89DDFF;font-style:italic;">graph</span><span style="color:#BABED8;"> </span><span style="color:#82AAFF;">TD</span></span>
<span class="line"><span style="color:#BABED8;">    A</span><span style="color:#89DDFF;font-style:italic;">[</span><span style="color:#C3E88D;">åˆå§‹åŒ–å­˜å‚¨å¯¹è±¡</span><span style="color:#89DDFF;font-style:italic;">]</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;font-style:italic;">--&gt;</span><span style="color:#BABED8;"> B</span><span style="color:#89DDFF;font-style:italic;">{</span><span style="color:#C3E88D;">æ£€æµ‹å­˜å‚¨å¯ç”¨æ€§</span><span style="color:#89DDFF;font-style:italic;">}</span></span>
<span class="line"><span style="color:#BABED8;">    B </span><span style="color:#89DDFF;font-style:italic;">--&gt;|</span><span style="color:#C3E88D;">å¯ç”¨</span><span style="color:#89DDFF;font-style:italic;">|</span><span style="color:#BABED8;"> C</span><span style="color:#89DDFF;font-style:italic;">[</span><span style="color:#C3E88D;">è¯»å–å­˜å‚¨å€¼</span><span style="color:#89DDFF;font-style:italic;">]</span></span>
<span class="line"><span style="color:#BABED8;">    B </span><span style="color:#89DDFF;font-style:italic;">--&gt;|</span><span style="color:#C3E88D;">ä¸å¯ç”¨</span><span style="color:#89DDFF;font-style:italic;">|</span><span style="color:#BABED8;"> D</span><span style="color:#89DDFF;font-style:italic;">[</span><span style="color:#C3E88D;">ä½¿ç”¨å†…å­˜å­˜å‚¨</span><span style="color:#89DDFF;font-style:italic;">]</span></span>
<span class="line"><span style="color:#BABED8;">    C </span><span style="color:#89DDFF;font-style:italic;">--&gt;</span><span style="color:#BABED8;"> E</span><span style="color:#89DDFF;font-style:italic;">[</span><span style="color:#C3E88D;">ååºåˆ—åŒ–å¤„ç†</span><span style="color:#89DDFF;font-style:italic;">]</span></span>
<span class="line"><span style="color:#BABED8;">    E </span><span style="color:#89DDFF;font-style:italic;">--&gt;</span><span style="color:#BABED8;"> F</span><span style="color:#89DDFF;font-style:italic;">[</span><span style="color:#C3E88D;">åˆå§‹åŒ–å“åº”å¼ref</span><span style="color:#89DDFF;font-style:italic;">]</span></span>
<span class="line"><span style="color:#BABED8;">    F </span><span style="color:#89DDFF;font-style:italic;">--&gt;</span><span style="color:#BABED8;"> G</span><span style="color:#89DDFF;font-style:italic;">[</span><span style="color:#C3E88D;">è®¾ç½®å­˜å‚¨ç›‘å¬</span><span style="color:#89DDFF;font-style:italic;">]</span></span>
<span class="line"><span style="color:#BABED8;">    G </span><span style="color:#89DDFF;font-style:italic;">--&gt;</span><span style="color:#BABED8;"> H</span><span style="color:#89DDFF;font-style:italic;">[</span><span style="color:#C3E88D;">è¿”å›å“åº”å¼ref</span><span style="color:#89DDFF;font-style:italic;">]</span></span>
<span class="line"><span style="color:#BABED8;">    H </span><span style="color:#89DDFF;font-style:italic;">--&gt;</span><span style="color:#BABED8;"> I</span><span style="color:#89DDFF;font-style:italic;">[</span><span style="color:#C3E88D;">å€¼å˜æ›´æ—¶è‡ªåŠ¨æ›´æ–°å­˜å‚¨</span><span style="color:#89DDFF;font-style:italic;">]</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h3 id="_3-å…³é”®æºç ç‰‡æ®µ" tabindex="-1">3. å…³é”®æºç ç‰‡æ®µ <a class="header-anchor" href="#_3-å…³é”®æºç ç‰‡æ®µ" aria-hidden="true">#</a></h3><div class="language-typescript line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#676E95;font-style:italic;">// æ ¸å¿ƒæ›´æ–°é€»è¾‘</span></span>
<span class="line"><span style="color:#C792EA;">function</span><span style="color:#BABED8;"> </span><span style="color:#82AAFF;">update</span><span style="color:#89DDFF;">(</span><span style="color:#BABED8;font-style:italic;">event</span><span style="color:#89DDFF;">?:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">StorageEvent</span><span style="color:#89DDFF;">)</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;"> (</span><span style="color:#89DDFF;">!</span><span style="color:#BABED8;">event</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">||</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">event</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">key</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">===</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">key</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">try</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">rawValue</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">event</span><span style="color:#89DDFF;">?.</span><span style="color:#BABED8;">newValue</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">??</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">storage</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">getItem</span><span style="color:#F07178;">(</span><span style="color:#BABED8;">key</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;"> (</span><span style="color:#BABED8;">rawValue</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">===</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">null</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&amp;&amp;</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">initialValue</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">!==</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">undefined</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#BABED8;">data</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">value</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">initialValue</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#82AAFF;">write</span><span style="color:#F07178;">()</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;font-style:italic;">else</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#BABED8;">data</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">value</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">rawValue</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">?</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">serializer</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">deserialize</span><span style="color:#F07178;">(</span><span style="color:#BABED8;">rawValue</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">null</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;font-style:italic;">catch</span><span style="color:#F07178;"> (</span><span style="color:#BABED8;">e</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#82AAFF;">onError</span><span style="color:#F07178;">(</span><span style="color:#BABED8;">e</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// å­˜å‚¨ç›‘å¬å®ç°</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#BABED8;"> (isClient </span><span style="color:#89DDFF;">&amp;&amp;</span><span style="color:#BABED8;"> passToListeners) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#82AAFF;">useEventListener</span><span style="color:#F07178;">(</span><span style="color:#BABED8;">window</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">storage</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">update</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// é”™è¯¯å¤„ç†é€»è¾‘</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#BABED8;"> onError </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">(</span><span style="color:#BABED8;font-style:italic;">e</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">unknown</span><span style="color:#89DDFF;">)</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#BABED8;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">warn</span><span style="color:#F07178;">(</span><span style="color:#BABED8;">e</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;font-style:italic;">// é™çº§ä¸ºå†…å­˜å­˜å‚¨</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;"> (</span><span style="color:#BABED8;">data</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">value</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">===</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">null</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&amp;&amp;</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">initialValue</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">!==</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">undefined</span><span style="color:#F07178;">) </span><span style="color:#BABED8;">data</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">value</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">initialValue</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br></div></div><h2 id="ä¸‰ã€å…³é”®æŠ€æœ¯ç‚¹è¯¦è§£" tabindex="-1">ä¸‰ã€å…³é”®æŠ€æœ¯ç‚¹è¯¦è§£ <a class="header-anchor" href="#ä¸‰ã€å…³é”®æŠ€æœ¯ç‚¹è¯¦è§£" aria-hidden="true">#</a></h2><h3 id="_1-æ™ºèƒ½å­˜å‚¨æ£€æµ‹" tabindex="-1">1. æ™ºèƒ½å­˜å‚¨æ£€æµ‹ <a class="header-anchor" href="#_1-æ™ºèƒ½å­˜å‚¨æ£€æµ‹" aria-hidden="true">#</a></h3><div class="language-typescript line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#676E95;font-style:italic;">// å­˜å‚¨å¯ç”¨æ€§æ£€æµ‹é€»è¾‘</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#BABED8;"> isClient </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">typeof</span><span style="color:#BABED8;"> window </span><span style="color:#89DDFF;">!==</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">undefined</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#BABED8;"> hasWebStorage </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;"> isClient </span><span style="color:#89DDFF;">&amp;&amp;</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">typeof</span><span style="color:#BABED8;"> storage </span><span style="color:#89DDFF;">!==</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">undefined</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// é™çº§å†…å­˜å­˜å‚¨å®ç°</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#BABED8;"> memory </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">new</span><span style="color:#BABED8;"> </span><span style="color:#82AAFF;">Map</span><span style="color:#89DDFF;">&lt;</span><span style="color:#FFCB6B;">string</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">string</span><span style="color:#89DDFF;">&gt;</span><span style="color:#BABED8;">()</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#BABED8;"> dummyStorage</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">StorageLike</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#82AAFF;">getItem</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#BABED8;font-style:italic;">key</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#BABED8;"> memory</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">get</span><span style="color:#BABED8;">(key) </span><span style="color:#89DDFF;">??</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">null,</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#82AAFF;">setItem</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">(</span><span style="color:#BABED8;font-style:italic;">key</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;"> </span><span style="color:#BABED8;font-style:italic;">value</span><span style="color:#89DDFF;">)</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#BABED8;"> memory</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">set</span><span style="color:#BABED8;">(key</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;"> value)</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#82AAFF;">removeItem</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#BABED8;font-style:italic;">key</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#BABED8;"> memory</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">delete</span><span style="color:#BABED8;">(key)</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h3 id="_2-åºåˆ—åŒ–ç³»ç»Ÿè®¾è®¡" tabindex="-1">2. åºåˆ—åŒ–ç³»ç»Ÿè®¾è®¡ <a class="header-anchor" href="#_2-åºåˆ—åŒ–ç³»ç»Ÿè®¾è®¡" aria-hidden="true">#</a></h3><div class="language-typescript line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#676E95;font-style:italic;">// é»˜è®¤åºåˆ—åŒ–å™¨</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#BABED8;"> defaultSerializer</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">Serializer</span><span style="color:#89DDFF;">&lt;</span><span style="color:#FFCB6B;">T</span><span style="color:#89DDFF;">&gt;</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#82AAFF;">read</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">(</span><span style="color:#BABED8;font-style:italic;">v</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">string</span><span style="color:#89DDFF;">)</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">try</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">JSON</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">parse</span><span style="color:#F07178;">(</span><span style="color:#BABED8;">v</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;font-style:italic;">catch</span><span style="color:#F07178;"> (</span><span style="color:#BABED8;">e</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">v</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#82AAFF;">write</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">(</span><span style="color:#BABED8;font-style:italic;">v</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">T</span><span style="color:#89DDFF;">)</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#BABED8;"> JSON</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">stringify</span><span style="color:#BABED8;">(v)</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// è‡ªå®šä¹‰åºåˆ—åŒ–å™¨å¤„ç†</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#BABED8;"> serializer </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;"> options</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">serializer </span><span style="color:#89DDFF;">??</span><span style="color:#BABED8;"> defaultSerializer</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><h3 id="_3-æ€§èƒ½ä¼˜åŒ–ç­–ç•¥" tabindex="-1">3. æ€§èƒ½ä¼˜åŒ–ç­–ç•¥ <a class="header-anchor" href="#_3-æ€§èƒ½ä¼˜åŒ–ç­–ç•¥" aria-hidden="true">#</a></h3><div class="language-typescript line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#676E95;font-style:italic;">// å†™æ“ä½œèŠ‚æµå¤„ç†</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#BABED8;"> write </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;"> </span><span style="color:#82AAFF;">useThrottleFn</span><span style="color:#BABED8;">(</span><span style="color:#89DDFF;">()</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;font-style:italic;">try</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;"> (</span><span style="color:#BABED8;">data</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">value</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">==</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">null</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#BABED8;">storage</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">removeItem</span><span style="color:#F07178;">(</span><span style="color:#BABED8;">key</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;font-style:italic;">else</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#BABED8;">storage</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">setItem</span><span style="color:#F07178;">(</span><span style="color:#BABED8;">key</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">serializer</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">write</span><span style="color:#F07178;">(</span><span style="color:#BABED8;">data</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">value</span><span style="color:#F07178;">))</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;font-style:italic;">catch</span><span style="color:#F07178;"> (</span><span style="color:#BABED8;">e</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#82AAFF;">onError</span><span style="color:#F07178;">(</span><span style="color:#BABED8;">e</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">},</span><span style="color:#BABED8;"> options</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">flush </span><span style="color:#89DDFF;">??</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">pre</span><span style="color:#89DDFF;">&#39;</span><span style="color:#BABED8;">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><h2 id="å››ã€ä½¿ç”¨ç¤ºä¾‹å¤§å…¨" tabindex="-1">å››ã€ä½¿ç”¨ç¤ºä¾‹å¤§å…¨ <a class="header-anchor" href="#å››ã€ä½¿ç”¨ç¤ºä¾‹å¤§å…¨" aria-hidden="true">#</a></h2><h3 id="_1-åŸºç¡€ä½¿ç”¨" tabindex="-1">1. åŸºç¡€ä½¿ç”¨ <a class="header-anchor" href="#_1-åŸºç¡€ä½¿ç”¨" aria-hidden="true">#</a></h3><div class="language-typescript line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#676E95;font-style:italic;">// è‡ªåŠ¨åŒæ­¥åˆ° localStorage</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#BABED8;"> count </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;"> </span><span style="color:#82AAFF;">useStorage</span><span style="color:#BABED8;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">counter</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">0</span><span style="color:#BABED8;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// æ˜¾ç¤ºä½¿ç”¨ sessionStorage</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#BABED8;"> sessionToken </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;"> </span><span style="color:#82AAFF;">useStorage</span><span style="color:#BABED8;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">auth-token</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">null,</span><span style="color:#BABED8;"> sessionStorage)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// å“åº”å¼æ›´æ–°ç¤ºä¾‹</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#BABED8;"> increment </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">()</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#BABED8;"> count</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">value</span><span style="color:#89DDFF;">++</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h3 id="_2-è‡ªå®šä¹‰åºåˆ—åŒ–å™¨" tabindex="-1">2. è‡ªå®šä¹‰åºåˆ—åŒ–å™¨ <a class="header-anchor" href="#_2-è‡ªå®šä¹‰åºåˆ—åŒ–å™¨" aria-hidden="true">#</a></h3><div class="language-typescript line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#676E95;font-style:italic;">// Date å¯¹è±¡åºåˆ—åŒ–</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#BABED8;"> dateSerializer </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#82AAFF;">read</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">(</span><span style="color:#BABED8;font-style:italic;">v</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">string</span><span style="color:#89DDFF;">)</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">new</span><span style="color:#BABED8;"> </span><span style="color:#82AAFF;">Date</span><span style="color:#BABED8;">(</span><span style="color:#82AAFF;">parseInt</span><span style="color:#BABED8;">(v))</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#82AAFF;">write</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">(</span><span style="color:#BABED8;font-style:italic;">v</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">Date</span><span style="color:#89DDFF;">)</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#BABED8;"> v</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">getTime</span><span style="color:#BABED8;">()</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">toString</span><span style="color:#BABED8;">()</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#BABED8;"> expiration </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;"> </span><span style="color:#82AAFF;">useStorage</span><span style="color:#BABED8;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">expiration</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">new</span><span style="color:#BABED8;"> </span><span style="color:#82AAFF;">Date</span><span style="color:#BABED8;">()</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">undefined,</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#F07178;">serializer</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> dateSerializer</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#BABED8;">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h3 id="_3-å¤æ‚æ•°æ®ç»“æ„" tabindex="-1">3. å¤æ‚æ•°æ®ç»“æ„ <a class="header-anchor" href="#_3-å¤æ‚æ•°æ®ç»“æ„" aria-hidden="true">#</a></h3><div class="language-typescript line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#676E95;font-style:italic;">// åµŒå¥—å¯¹è±¡å¤„ç†</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#BABED8;"> userSettings </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;"> </span><span style="color:#82AAFF;">useStorage</span><span style="color:#BABED8;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">user-settings</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#F07178;">theme</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">dark</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#F07178;">preferences</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#F07178;">fontSize</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">16</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#F07178;">notifications</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FF9CAC;">true</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#BABED8;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// ä¿®æ”¹åµŒå¥—å±æ€§</span></span>
<span class="line"><span style="color:#BABED8;">userSettings</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">value</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">preferences</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">fontSize </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">14</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h3 id="_4-é«˜çº§é…ç½®é€‰é¡¹" tabindex="-1">4. é«˜çº§é…ç½®é€‰é¡¹ <a class="header-anchor" href="#_4-é«˜çº§é…ç½®é€‰é¡¹" aria-hidden="true">#</a></h3><div class="language-typescript line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#676E95;font-style:italic;">// ç¦ç”¨äº‹ä»¶ç›‘å¬</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#BABED8;"> localData </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;"> </span><span style="color:#82AAFF;">useStorage</span><span style="color:#BABED8;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">local-data</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{},</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">undefined,</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#F07178;">listenToStorageChanges</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FF9CAC;">false</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#BABED8;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// è‡ªå®šä¹‰é”™è¯¯å¤„ç†</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#BABED8;"> safeStorage </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;"> </span><span style="color:#82AAFF;">useStorage</span><span style="color:#BABED8;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">critical-data</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{},</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">undefined,</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#82AAFF;">onError</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#BABED8;font-style:italic;">e</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#BABED8;">Sentry</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">captureException</span><span style="color:#F07178;">(</span><span style="color:#BABED8;">e</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#82AAFF;">showErrorToast</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">å­˜å‚¨å¤±è´¥</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#BABED8;">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><h2 id="äº”ã€ssr-åœºæ™¯å¤„ç†" tabindex="-1">äº”ã€SSR åœºæ™¯å¤„ç† <a class="header-anchor" href="#äº”ã€ssr-åœºæ™¯å¤„ç†" aria-hidden="true">#</a></h2><h3 id="_1-nuxt-js-é›†æˆç¤ºä¾‹" tabindex="-1">1. Nuxt.js é›†æˆç¤ºä¾‹ <a class="header-anchor" href="#_1-nuxt-js-é›†æˆç¤ºä¾‹" aria-hidden="true">#</a></h3><div class="language-typescript line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#676E95;font-style:italic;">// plugins/storage.ts</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;font-style:italic;">default</span><span style="color:#BABED8;"> </span><span style="color:#82AAFF;">defineNuxtPlugin</span><span style="color:#BABED8;">(</span><span style="color:#89DDFF;">()</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">cookieStorage</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#82AAFF;">getItem</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">(</span><span style="color:#BABED8;font-style:italic;">key</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#FFCB6B;">string</span><span style="color:#89DDFF;">)</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">useCookie</span><span style="color:#F07178;">(</span><span style="color:#BABED8;">key</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">value</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#82AAFF;">setItem</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">(</span><span style="color:#BABED8;font-style:italic;">key</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#FFCB6B;">string</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#BABED8;font-style:italic;">value</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#FFCB6B;">string</span><span style="color:#89DDFF;">)</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> (</span><span style="color:#82AAFF;">useCookie</span><span style="color:#F07178;">(</span><span style="color:#BABED8;">key</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">value</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">value</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    provide</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#82AAFF;">useStorage</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">(</span><span style="color:#BABED8;font-style:italic;">key</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#FFCB6B;">string</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#BABED8;font-style:italic;">value</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#FFCB6B;">any</span><span style="color:#89DDFF;">)</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">useStorage</span><span style="color:#F07178;">(</span><span style="color:#BABED8;">key</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">value</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">cookieStorage</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#BABED8;">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><h3 id="_2-æœåŠ¡ç«¯æ•°æ®æ°´åˆ" tabindex="-1">2. æœåŠ¡ç«¯æ•°æ®æ°´åˆ <a class="header-anchor" href="#_2-æœåŠ¡ç«¯æ•°æ®æ°´åˆ" aria-hidden="true">#</a></h3><div class="language-typescript line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#676E95;font-style:italic;">// ç»„ä»¶å†…ä½¿ç”¨</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#BABED8;"> serverData </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;"> </span><span style="color:#82AAFF;">useStorage</span><span style="color:#BABED8;">(</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">ssr-data</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#BABED8;">  initValue</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#BABED8;">  process</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">client</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#89DDFF;">?</span><span style="color:#BABED8;"> localStorage</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#BABED8;">        </span><span style="color:#82AAFF;">getItem</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">()</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#BABED8;"> initValue</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#BABED8;">        </span><span style="color:#82AAFF;">setItem</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">()</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{},</span></span>
<span class="line"><span style="color:#BABED8;">      </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#BABED8;">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h2 id="å…­ã€æ€§èƒ½ä¸å®‰å…¨" tabindex="-1">å…­ã€æ€§èƒ½ä¸å®‰å…¨ <a class="header-anchor" href="#å…­ã€æ€§èƒ½ä¸å®‰å…¨" aria-hidden="true">#</a></h2><h3 id="_1-æ€§èƒ½ä¼˜åŒ–å»ºè®®" tabindex="-1">1. æ€§èƒ½ä¼˜åŒ–å»ºè®® <a class="header-anchor" href="#_1-æ€§èƒ½ä¼˜åŒ–å»ºè®®" aria-hidden="true">#</a></h3><ul><li>å¯¹é«˜é¢‘æ›´æ–°æ“ä½œä½¿ç”¨ <code>flush: &#39;post&#39;</code> é€‰é¡¹</li><li>å¤§æ•°æ®ç»“æ„æ¨èä½¿ç”¨å‹ç¼©åºåˆ—åŒ–å™¨</li><li>é¿å…åœ¨å­˜å‚¨ä¸­ä¿å­˜é¢‘ç¹å˜åŒ–çš„éå…³é”®æ•°æ®</li></ul><h3 id="_2-å®‰å…¨å®è·µ" tabindex="-1">2. å®‰å…¨å®è·µ <a class="header-anchor" href="#_2-å®‰å…¨å®è·µ" aria-hidden="true">#</a></h3><div class="language-typescript line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#676E95;font-style:italic;">// åŠ å¯†å­˜å‚¨ç¤ºä¾‹</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#BABED8;"> cryptoSerializer </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#82AAFF;">read</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">(</span><span style="color:#BABED8;font-style:italic;">v</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">string</span><span style="color:#89DDFF;">)</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#BABED8;"> </span><span style="color:#82AAFF;">decrypt</span><span style="color:#BABED8;">(v)</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#82AAFF;">write</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">(</span><span style="color:#BABED8;font-style:italic;">v</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">any</span><span style="color:#89DDFF;">)</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#BABED8;"> </span><span style="color:#82AAFF;">encrypt</span><span style="color:#BABED8;">(JSON</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">stringify</span><span style="color:#BABED8;">(v))</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#BABED8;"> secureStorage </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;"> </span><span style="color:#82AAFF;">useStorage</span><span style="color:#BABED8;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">secret</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;"> data</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">undefined,</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#F07178;">serializer</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> cryptoSerializer</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#BABED8;">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h2 id="ä¸ƒã€å®ç°åŸç†æ·±åº¦å‰–æ" tabindex="-1">ä¸ƒã€å®ç°åŸç†æ·±åº¦å‰–æ <a class="header-anchor" href="#ä¸ƒã€å®ç°åŸç†æ·±åº¦å‰–æ" aria-hidden="true">#</a></h2><h3 id="_1-å“åº”å¼åŒæ­¥æœºåˆ¶" tabindex="-1">1. å“åº”å¼åŒæ­¥æœºåˆ¶ <a class="header-anchor" href="#_1-å“åº”å¼åŒæ­¥æœºåˆ¶" aria-hidden="true">#</a></h3><div class="language-typescript line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#676E95;font-style:italic;">// æ ¸å¿ƒç›‘å¬å®ç°</span></span>
<span class="line"><span style="color:#82AAFF;">watch</span><span style="color:#BABED8;">(</span></span>
<span class="line"><span style="color:#BABED8;">  data</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#89DDFF;">()</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;"> (</span><span style="color:#BABED8;">updating</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;font-style:italic;">return</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#82AAFF;">write</span><span style="color:#F07178;">()</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#89DDFF;">{</span><span style="color:#BABED8;"> </span><span style="color:#F07178;">deep</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> options</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">deep </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#BABED8;">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h3 id="_2-å­˜å‚¨äº‹ä»¶å¤„ç†" tabindex="-1">2. å­˜å‚¨äº‹ä»¶å¤„ç† <a class="header-anchor" href="#_2-å­˜å‚¨äº‹ä»¶å¤„ç†" aria-hidden="true">#</a></h3><div class="language-typescript line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#676E95;font-style:italic;">// è·¨æ ‡ç­¾é¡µåŒæ­¥é€»è¾‘</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#BABED8;"> updateFromStorage </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">(</span><span style="color:#BABED8;font-style:italic;">event</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">StorageEvent</span><span style="color:#89DDFF;">)</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;"> (</span><span style="color:#BABED8;">event</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">key</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">!==</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">key</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;font-style:italic;">return</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#BABED8;">updating</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#FF9CAC;">true</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;font-style:italic;">try</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#BABED8;">data</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">value</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">event</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">newValue</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">?</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">serializer</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">read</span><span style="color:#F07178;">(</span><span style="color:#BABED8;">event</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">newValue</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">null</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;font-style:italic;">finally</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#BABED8;">updating</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#FF9CAC;">false</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#BABED8;"> (listenToStorageChanges) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#BABED8;">window</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">addEventListener</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">storage</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">updateFromStorage</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><h2 id="å…«ã€å¯¹æ¯”åŸç”Ÿå®ç°ä¼˜åŠ¿" tabindex="-1">å…«ã€å¯¹æ¯”åŸç”Ÿå®ç°ä¼˜åŠ¿ <a class="header-anchor" href="#å…«ã€å¯¹æ¯”åŸç”Ÿå®ç°ä¼˜åŠ¿" aria-hidden="true">#</a></h2><table><thead><tr><th>åŠŸèƒ½ç‚¹</th><th>åŸç”Ÿå®ç°</th><th>useStorage</th></tr></thead><tbody><tr><td>å“åº”å¼æ”¯æŒ</td><td>éœ€æ‰‹åŠ¨å®ç°</td><td>è‡ªåŠ¨åŒæ­¥</td></tr><tr><td>ç±»å‹å®‰å…¨</td><td>æ— </td><td>å®Œæ•´ TypeScript æ”¯æŒ</td></tr><tr><td>é”™è¯¯å¤„ç†</td><td>éœ€è‡ªè¡Œå°è£…</td><td>å†…ç½®é™çº§ç­–ç•¥</td></tr><tr><td>è·¨æ ‡ç­¾é¡µåŒæ­¥</td><td>éœ€ç¼–å†™äº‹ä»¶ç›‘å¬</td><td>è‡ªåŠ¨å¤„ç†</td></tr><tr><td>åºåˆ—åŒ–å¤„ç†</td><td>éœ€æ‰‹åŠ¨ JSON è½¬æ¢</td><td>æ™ºèƒ½å¤„ç†å¤æ‚å¯¹è±¡</td></tr><tr><td>æ€§èƒ½ä¼˜åŒ–</td><td>æ— </td><td>å†…ç½®å†™æ“ä½œèŠ‚æµ</td></tr></tbody></table><h2 id="ä¹ã€æœ€ä½³å®è·µåœºæ™¯" tabindex="-1">ä¹ã€æœ€ä½³å®è·µåœºæ™¯ <a class="header-anchor" href="#ä¹ã€æœ€ä½³å®è·µåœºæ™¯" aria-hidden="true">#</a></h2><ol><li><p><strong>ç”¨æˆ·åå¥½è®¾ç½®</strong></p><div class="language-typescript line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#C792EA;">const</span><span style="color:#BABED8;"> settings </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;"> </span><span style="color:#82AAFF;">useStorage</span><span style="color:#BABED8;">(</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">user-settings</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#F07178;">darkMode</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FF9CAC;">true</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#F07178;">locale</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">zh-CN</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#F07178;">fontSize</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">14</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#BABED8;">  localStorage</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#F07178;">mergeDefaults</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FF9CAC;">true</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#BABED8;">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div></li><li><p><strong>è¡¨å•è‰ç¨¿ä¿å­˜</strong></p><div class="language-typescript line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#C792EA;">const</span><span style="color:#BABED8;"> draft </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;"> </span><span style="color:#82AAFF;">useStorage</span><span style="color:#BABED8;">(</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">form-draft</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#F07178;">title</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&#39;&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#F07178;">content</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&#39;&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#F07178;">attachments</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> []</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#89DDFF;">undefined,</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#F07178;">flush</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">post</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#F07178;">deep</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FF9CAC;">true</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#BABED8;">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div></li><li><p><strong>è´­ç‰©è½¦çŠ¶æ€ç»´æŠ¤</strong></p><div class="language-typescript line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#C792EA;">const</span><span style="color:#BABED8;"> cart </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;"> </span><span style="color:#82AAFF;">useStorage</span><span style="color:#89DDFF;">&lt;</span><span style="color:#FFCB6B;">CartItem</span><span style="color:#BABED8;">[]</span><span style="color:#89DDFF;">&gt;</span><span style="color:#BABED8;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">shopping-cart</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;"> []</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;"> sessionStorage</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#F07178;">serializer</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#82AAFF;">read</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#BABED8;font-style:italic;">v</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#BABED8;"> JSON</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">parse</span><span style="color:#BABED8;">(v)</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">map</span><span style="color:#BABED8;">(validateCartItem)</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#82AAFF;">write</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#BABED8;font-style:italic;">v</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#BABED8;"> JSON</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">stringify</span><span style="color:#BABED8;">(v</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">filter</span><span style="color:#BABED8;">(purgeSensitiveData))</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#BABED8;">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div></li></ol><h2 id="åã€æ³¨æ„äº‹é¡¹" tabindex="-1">åã€æ³¨æ„äº‹é¡¹ <a class="header-anchor" href="#åã€æ³¨æ„äº‹é¡¹" aria-hidden="true">#</a></h2><ol><li><p><strong>å­˜å‚¨é™åˆ¶</strong></p><ul><li>å•ä¸ªåŸŸåå­˜å‚¨ä¸Šé™é€šå¸¸ä¸º 5MB</li><li>è¶…å‡ºé™åˆ¶ä¼šè§¦å‘ QuotaExceededError</li></ul></li><li><p><strong>æ•æ„Ÿä¿¡æ¯å¤„ç†</strong></p><ul><li>é¿å…å­˜å‚¨æ˜æ–‡å¯†ç /ä»¤ç‰Œ</li><li>æ¨èç»“åˆåŠ å¯†åº“ä½¿ç”¨</li></ul></li><li><p><strong>æ•°æ®ç±»å‹é™åˆ¶</strong></p><ul><li>æ— æ³•å­˜å‚¨å‡½æ•°ã€Symbol ç­‰ç‰¹æ®Šç±»å‹</li><li>å¾ªç¯å¼•ç”¨å¯¹è±¡éœ€è¦ç‰¹æ®Šå¤„ç†</li></ul></li><li><p><strong>æ¡†æ¶é›†æˆ</strong></p><div class="language-typescript line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#676E95;font-style:italic;">// åœ¨Vuex/Piniaä¸­çš„ä½¿ç”¨</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#BABED8;"> store </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;"> </span><span style="color:#82AAFF;">defineStore</span><span style="color:#BABED8;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">main</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">()</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">persistedState</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">useStorage</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">store-state</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    count</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">...</span><span style="color:#BABED8;">persistedState</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">value</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#BABED8;">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div></li></ol><h2 id="åä¸€ã€æ‰©å±•åº”ç”¨" tabindex="-1">åä¸€ã€æ‰©å±•åº”ç”¨ <a class="header-anchor" href="#åä¸€ã€æ‰©å±•åº”ç”¨" aria-hidden="true">#</a></h2><h3 id="_1-å®ç°è¿‡æœŸæœºåˆ¶" tabindex="-1">1. å®ç°è¿‡æœŸæœºåˆ¶ <a class="header-anchor" href="#_1-å®ç°è¿‡æœŸæœºåˆ¶" aria-hidden="true">#</a></h3><div class="language-typescript line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#C792EA;">function</span><span style="color:#BABED8;"> </span><span style="color:#82AAFF;">useExpirableStorage</span><span style="color:#89DDFF;">&lt;</span><span style="color:#FFCB6B;">T</span><span style="color:#89DDFF;">&gt;(</span><span style="color:#BABED8;font-style:italic;">key</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">string</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;"> </span><span style="color:#BABED8;font-style:italic;">ttl</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">number</span><span style="color:#89DDFF;">)</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">wrapper</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">useStorage</span><span style="color:#89DDFF;">&lt;{</span></span>
<span class="line"><span style="color:#F07178;">    data</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#FFCB6B;">T</span></span>
<span class="line"><span style="color:#F07178;">    expires</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#FFCB6B;">number</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}&gt;</span><span style="color:#F07178;">(</span><span style="color:#BABED8;">key</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> data</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">null,</span><span style="color:#F07178;"> expires</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">0</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">update</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">(</span><span style="color:#BABED8;font-style:italic;">value</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#FFCB6B;">T</span><span style="color:#89DDFF;">)</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#BABED8;">wrapper</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">value</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      data</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">value</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">      expires</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">Date</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">now</span><span style="color:#F07178;">() </span><span style="color:#89DDFF;">+</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">ttl</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">current</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">computed</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">()</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;"> (</span><span style="color:#BABED8;">Date</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">now</span><span style="color:#F07178;">() </span><span style="color:#89DDFF;">&gt;</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">wrapper</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">value</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">expires</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">null</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">wrapper</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">value</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">data</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> [</span><span style="color:#BABED8;">current</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">update</span><span style="color:#F07178;">]</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><h3 id="_2-å®ç°å­˜å‚¨ç©ºé—´ç›‘æ§" tabindex="-1">2. å®ç°å­˜å‚¨ç©ºé—´ç›‘æ§ <a class="header-anchor" href="#_2-å®ç°å­˜å‚¨ç©ºé—´ç›‘æ§" aria-hidden="true">#</a></h3><div class="language-typescript line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#C792EA;">const</span><span style="color:#BABED8;"> storageUsage </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;"> </span><span style="color:#82AAFF;">computed</span><span style="color:#BABED8;">(</span><span style="color:#89DDFF;">()</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">let</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">total</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">0</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;font-style:italic;">for</span><span style="color:#F07178;"> (</span><span style="color:#C792EA;">let</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">i</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">;</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">i</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">localStorage</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">length</span><span style="color:#89DDFF;">;</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">i</span><span style="color:#89DDFF;">++</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">key</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">localStorage</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">key</span><span style="color:#F07178;">(</span><span style="color:#BABED8;">i</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">!</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#BABED8;">total</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">+=</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">localStorage</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">getItem</span><span style="color:#F07178;">(</span><span style="color:#BABED8;">key</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">?.</span><span style="color:#BABED8;">length</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">||</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">0</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> (</span><span style="color:#BABED8;">total</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">/</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">1024</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">toFixed</span><span style="color:#F07178;">(</span><span style="color:#F78C6C;">2</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">+</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">KB</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#BABED8;">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h2 id="åäºŒã€æ€»ç»“" tabindex="-1">åäºŒã€æ€»ç»“ <a class="header-anchor" href="#åäºŒã€æ€»ç»“" aria-hidden="true">#</a></h2><p><code>useStorage</code> çš„å®ç°å±•ç¤ºäº†ä»¥ä¸‹ç²¾å¦™è®¾è®¡ï¼š</p><ol><li><p><strong>åˆ†å±‚æ¶æ„è®¾è®¡</strong><br> é€šè¿‡å­˜å‚¨é€‚é…å™¨æ¨¡å¼ï¼Œåˆ†ç¦»æ ¸å¿ƒé€»è¾‘ä¸å…·ä½“å­˜å‚¨å®ç°</p></li><li><p><strong>é˜²å¾¡æ€§ç¼–ç¨‹</strong><br> å…¨é¢çš„é”™è¯¯æ•è·ä¸é™çº§ç­–ç•¥ç¡®ä¿ä»£ç å¥å£®æ€§</p></li><li><p><strong>æ€§èƒ½å¹³è¡¡è‰ºæœ¯</strong><br> æ™ºèƒ½çš„èŠ‚æµæ§åˆ¶ä¸æ‰¹é‡æ›´æ–°ç­–ç•¥</p></li><li><p><strong>æ‰©å±•æ€§è®¾è®¡</strong><br> å¼€æ”¾çš„åºåˆ—åŒ–å™¨æ¥å£ä¸é…ç½®é€‰é¡¹</p></li></ol><p>å»ºè®®åœ¨ä»¥ä¸‹åœºæ™¯ä¼˜å…ˆé€‰æ‹©ï¼š<br> âœ… éœ€è¦æŒä¹…åŒ–çš„ç”¨æˆ·åå¥½è®¾ç½®<br> âœ… è·¨é¡µé¢/æ ‡ç­¾é¡µçš„çŠ¶æ€å…±äº«<br> âœ… éœ€è¦é˜²æ­¢æ•°æ®ä¸¢å¤±çš„è‰ç¨¿åŠŸèƒ½<br> âœ… è½»é‡çº§çŠ¶æ€æŒä¹…åŒ–éœ€æ±‚</p>`,57)])])}const B=n(o,[["render",e]]);export{i as __pageData,B as default};
