import{_ as a,o as n,c as l,a as p}from"./app.7c6fd316.js";const F=JSON.parse('{"title":"toRaw源码解析与实际应用","description":"","frontmatter":{"top":10,"sticky":1000,"sidebar":{"title":"toRaw源码解析与实际应用","isTimeLine":true},"title":"toRaw源码解析与实际应用","date":"2025-04-12T00:00:00.000Z","tags":["前端","javascript","源码","Vue3"],"categories":["前端"]},"headers":[{"level":2,"title":"一、toRaw 方法的作用","slug":"一、toraw-方法的作用","link":"#一、toraw-方法的作用","children":[{"level":3,"title":"示例","slug":"示例","link":"#示例","children":[]}]},{"level":2,"title":"二、toRaw 的源码实现","slug":"二、toraw-的源码实现","link":"#二、toraw-的源码实现","children":[{"level":3,"title":"源码位置","slug":"源码位置","link":"#源码位置","children":[]},{"level":3,"title":"实现原理","slug":"实现原理","link":"#实现原理","children":[]},{"level":3,"title":"源码中的上下文","slug":"源码中的上下文","link":"#源码中的上下文","children":[]}]},{"level":2,"title":"三、在实际项目中的应用","slug":"三、在实际项目中的应用","link":"#三、在实际项目中的应用","children":[{"level":3,"title":"1. 与第三方库集成","slug":"_1-与第三方库集成","link":"#_1-与第三方库集成","children":[]},{"level":3,"title":"2. 数据对比与调试","slug":"_2-数据对比与调试","link":"#_2-数据对比与调试","children":[]},{"level":3,"title":"3. 性能优化","slug":"_3-性能优化","link":"#_3-性能优化","children":[]},{"level":3,"title":"4. 处理嵌套对象","slug":"_4-处理嵌套对象","link":"#_4-处理嵌套对象","children":[]}]},{"level":2,"title":"四、使用注意事项","slug":"四、使用注意事项","link":"#四、使用注意事项","children":[]},{"level":2,"title":"五、总结","slug":"五、总结","link":"#五、总结","children":[]}],"relativePath":"Vue3Source/toRaw源码解析与实际应用.md","lastUpdated":1763393448000}'),o={name:"Vue3Source/toRaw源码解析与实际应用.md"};function e(t,s,r,c,y,i){return n(),l("div",{"data-pagefind-body":!0},[...s[0]||(s[0]=[p(`<p>以下是一篇关于 Vue 3 中 <code>toRaw</code> 方法的源码实现及其在实际项目中应用的博客，内容涵盖了技术细节和实用场景：</p><hr><h1 id="toraw方法-源码解析与实际应用" tabindex="-1"><code>toRaw</code>方法：源码解析与实际应用 <a class="header-anchor" href="#toraw方法-源码解析与实际应用" aria-hidden="true">#</a></h1><p>Vue 3 作为前端开发中广受欢迎的框架，其响应式系统是核心特性之一。通过 Proxy 和 reactive/ref 等 API，Vue 实现了数据的动态追踪和更新。然而，在某些场景下，我们需要绕过响应式，直接访问原始数据，这时 <code>toRaw</code> 方法就派上了用场。本文将深入剖析 <code>toRaw</code> 的源码实现，并结合实际项目探讨其应用场景。</p><h2 id="一、toraw-方法的作用" tabindex="-1">一、<code>toRaw</code> 方法的作用 <a class="header-anchor" href="#一、toraw-方法的作用" aria-hidden="true">#</a></h2><p>在 Vue 3 中，<code>reactive</code> 和 <code>ref</code> 创建的响应式对象本质上是原始对象的代理（Proxy）。这些代理对象在读写时会触发依赖收集和更新，但有时我们需要访问原始数据本身，而不是代理对象。例如：</p><ul><li>需要传递数据给外部库，而外部库不理解 Proxy。</li><li>需要对比原始数据和修改后的数据。</li><li>优化性能，避免不必要的响应式追踪。</li></ul><p><code>toRaw</code> 方法的作用就是从响应式对象中提取其原始数据。它接受一个响应式对象（由 <code>reactive</code> 或 <code>ref</code> 创建），返回对应的原始对象。</p><h3 id="示例" tabindex="-1">示例 <a class="header-anchor" href="#示例" aria-hidden="true">#</a></h3><div class="language-javascript line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">reactive</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">toRaw</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">vue</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#BABED8;"> rawObj </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span><span style="color:#BABED8;"> </span><span style="color:#F07178;">name</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">Vue</span><span style="color:#89DDFF;">&#39;</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#BABED8;"> reactiveObj </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;"> </span><span style="color:#82AAFF;">reactive</span><span style="color:#BABED8;">(rawObj)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BABED8;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#BABED8;">(reactiveObj </span><span style="color:#89DDFF;">===</span><span style="color:#BABED8;"> rawObj) </span><span style="color:#676E95;font-style:italic;">// false，reactiveObj 是 Proxy</span></span>
<span class="line"><span style="color:#BABED8;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#BABED8;">(</span><span style="color:#82AAFF;">toRaw</span><span style="color:#BABED8;">(reactiveObj) </span><span style="color:#89DDFF;">===</span><span style="color:#BABED8;"> rawObj) </span><span style="color:#676E95;font-style:italic;">// true，toRaw 返回原始对象</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h2 id="二、toraw-的源码实现" tabindex="-1">二、<code>toRaw</code> 的源码实现 <a class="header-anchor" href="#二、toraw-的源码实现" aria-hidden="true">#</a></h2><p><code>toRaw</code> 的实现位于 Vue 3 的 <code>reactivity</code> 模块中，我们可以从源码角度深入理解其工作原理。以下是简化后的核心实现（基于 Vue 3.4.x 版本，具体细节可能因版本略有差异）：</p><h3 id="源码位置" tabindex="-1">源码位置 <a class="header-anchor" href="#源码位置" aria-hidden="true">#</a></h3><p><code>toRaw</code> 定义在 <code>packages/reactivity/src/reactive.ts</code> 中：</p><div class="language-typescript line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">function</span><span style="color:#BABED8;"> </span><span style="color:#82AAFF;">toRaw</span><span style="color:#89DDFF;">&lt;</span><span style="color:#FFCB6B;">T</span><span style="color:#89DDFF;">&gt;(</span><span style="color:#BABED8;font-style:italic;">observed</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">T</span><span style="color:#89DDFF;">):</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">T</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;font-style:italic;">// 如果传入的对象有 __v_raw 属性，则返回其原始对象</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">raw</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">observed</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&amp;&amp;</span><span style="color:#F07178;"> (</span><span style="color:#BABED8;">observed</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;font-style:italic;">as</span><span style="color:#F07178;"> </span><span style="color:#FFCB6B;">any</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">__v_raw</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;font-style:italic;">// 如果存在 raw，则递归调用 toRaw，否则返回 observed</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">raw</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">?</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">toRaw</span><span style="color:#F07178;">(</span><span style="color:#BABED8;">raw</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">observed</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h3 id="实现原理" tabindex="-1">实现原理 <a class="header-anchor" href="#实现原理" aria-hidden="true">#</a></h3><ol><li><p><strong>检查 <code>__v_raw</code> 属性</strong>：</p><ul><li>Vue 在创建响应式对象时，会在 Proxy 上添加一个隐藏属性 <code>__v_raw</code>，它指向原始对象。</li><li><code>toRaw</code> 首先检查传入的对象是否存在 <code>__v_raw</code>，如果存在，说明这是一个 Proxy。</li></ul></li><li><p><strong>递归处理</strong>：</p><ul><li>如果存在 <code>__v_raw</code>，<code>toRaw</code> 会递归调用自身，传入 <code>__v_raw</code> 的值，直到找到真正的原始对象。</li><li>这种递归设计是为了处理嵌套响应式对象的情况。</li></ul></li><li><p><strong>直接返回</strong>：</p><ul><li>如果传入的对象没有 <code>__v_raw</code>（即不是响应式对象），则直接返回原对象。</li></ul></li></ol><h3 id="源码中的上下文" tabindex="-1">源码中的上下文 <a class="header-anchor" href="#源码中的上下文" aria-hidden="true">#</a></h3><p>在 Vue 的响应式系统中，<code>reactive</code> 的实现依赖于 WeakMap 来存储原始对象和 Proxy 的映射关系：</p><div class="language-typescript line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#C792EA;">const</span><span style="color:#BABED8;"> rawToReactive </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">new</span><span style="color:#BABED8;"> </span><span style="color:#82AAFF;">WeakMap</span><span style="color:#89DDFF;">&lt;</span><span style="color:#FFCB6B;">any</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">any</span><span style="color:#89DDFF;">&gt;</span><span style="color:#BABED8;">()</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#BABED8;"> reactiveToRaw </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">new</span><span style="color:#BABED8;"> </span><span style="color:#82AAFF;">WeakMap</span><span style="color:#89DDFF;">&lt;</span><span style="color:#FFCB6B;">any</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">any</span><span style="color:#89DDFF;">&gt;</span><span style="color:#BABED8;">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">function</span><span style="color:#BABED8;"> </span><span style="color:#82AAFF;">reactive</span><span style="color:#89DDFF;">(</span><span style="color:#BABED8;font-style:italic;">target</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">object</span><span style="color:#89DDFF;">)</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;font-style:italic;">// 如果已经是 Proxy，直接返回</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;"> (</span><span style="color:#82AAFF;">isReadonly</span><span style="color:#F07178;">(</span><span style="color:#BABED8;">target</span><span style="color:#F07178;">)) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">target</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;font-style:italic;">// 检查缓存</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">existingProxy</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">rawToReactive</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">get</span><span style="color:#F07178;">(</span><span style="color:#BABED8;">target</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;"> (</span><span style="color:#BABED8;">existingProxy</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">existingProxy</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;font-style:italic;">// 创建 Proxy</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">proxy</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">new</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">Proxy</span><span style="color:#F07178;">(</span><span style="color:#BABED8;">target</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">mutableHandlers</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#BABED8;">rawToReactive</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">set</span><span style="color:#F07178;">(</span><span style="color:#BABED8;">target</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">proxy</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#BABED8;">reactiveToRaw</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">set</span><span style="color:#F07178;">(</span><span style="color:#BABED8;">proxy</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">target</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">proxy</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><p><code>toRaw</code> 通过 <code>__v_raw</code> 或直接访问原始对象，利用了这种映射关系。值得注意的是，<code>__v_raw</code> 是 Vue 内部使用的标记，开发者无法直接访问。</p><h2 id="三、在实际项目中的应用" tabindex="-1">三、在实际项目中的应用 <a class="header-anchor" href="#三、在实际项目中的应用" aria-hidden="true">#</a></h2><p><code>toRaw</code> 虽然是个小工具，但在特定场景下非常实用。以下是几个常见的应用案例：</p><h3 id="_1-与第三方库集成" tabindex="-1">1. 与第三方库集成 <a class="header-anchor" href="#_1-与第三方库集成" aria-hidden="true">#</a></h3><p>许多第三方库（如 Lodash、Axios 等）不理解 Proxy 对象。如果直接将 <code>reactive</code> 对象传入，可能会导致错误或意外行为。这时可以用 <code>toRaw</code> 获取原始数据。</p><div class="language-javascript line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">reactive</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">toRaw</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">vue</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#BABED8;"> _ </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">lodash</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#BABED8;"> state </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;"> </span><span style="color:#82AAFF;">reactive</span><span style="color:#BABED8;">(</span><span style="color:#89DDFF;">{</span><span style="color:#BABED8;"> </span><span style="color:#F07178;">list</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> [</span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">2</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">3</span><span style="color:#BABED8;">] </span><span style="color:#89DDFF;">}</span><span style="color:#BABED8;">)</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// 使用 Lodash 操作原始数据</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#BABED8;"> rawState </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;"> </span><span style="color:#82AAFF;">toRaw</span><span style="color:#BABED8;">(state)</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#BABED8;"> cloned </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;"> _</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">cloneDeep</span><span style="color:#BABED8;">(rawState)</span></span>
<span class="line"><span style="color:#BABED8;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#BABED8;">(cloned) </span><span style="color:#676E95;font-style:italic;">// { list: [1, 2, 3] }</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h3 id="_2-数据对比与调试" tabindex="-1">2. 数据对比与调试 <a class="header-anchor" href="#_2-数据对比与调试" aria-hidden="true">#</a></h3><p>在开发中，我们可能需要对比数据修改前后的状态。直接对比 <code>reactive</code> 对象会因为 Proxy 而变得复杂，使用 <code>toRaw</code> 可以简化操作。</p><div class="language-javascript line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">reactive</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">toRaw</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">vue</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#BABED8;"> original </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span><span style="color:#BABED8;"> </span><span style="color:#F07178;">count</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">0</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#BABED8;"> state </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;"> </span><span style="color:#82AAFF;">reactive</span><span style="color:#BABED8;">(original)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BABED8;">state</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">count </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">10</span></span>
<span class="line"><span style="color:#BABED8;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#BABED8;">(</span><span style="color:#82AAFF;">toRaw</span><span style="color:#BABED8;">(state)</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">count) </span><span style="color:#676E95;font-style:italic;">// 10</span></span>
<span class="line"><span style="color:#BABED8;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#BABED8;">(original</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">count) </span><span style="color:#676E95;font-style:italic;">// 10，原始对象也被修改</span></span>
<span class="line"><span style="color:#BABED8;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#BABED8;">(</span><span style="color:#82AAFF;">toRaw</span><span style="color:#BABED8;">(state) </span><span style="color:#89DDFF;">===</span><span style="color:#BABED8;"> original) </span><span style="color:#676E95;font-style:italic;">// true</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h3 id="_3-性能优化" tabindex="-1">3. 性能优化 <a class="header-anchor" href="#_3-性能优化" aria-hidden="true">#</a></h3><p>在某些场景下，我们需要临时禁用响应式追踪以提升性能。例如，批量更新数据时：</p><div class="language-javascript line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">reactive</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">toRaw</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">vue</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#BABED8;"> state </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;"> </span><span style="color:#82AAFF;">reactive</span><span style="color:#BABED8;">(</span><span style="color:#89DDFF;">{</span><span style="color:#BABED8;"> </span><span style="color:#F07178;">items</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> [] </span><span style="color:#89DDFF;">}</span><span style="color:#BABED8;">)</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// 批量更新，避免触发多次响应式更新</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#BABED8;"> rawItems </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;"> </span><span style="color:#82AAFF;">toRaw</span><span style="color:#BABED8;">(state)</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">items</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">for</span><span style="color:#BABED8;"> (</span><span style="color:#C792EA;">let</span><span style="color:#BABED8;"> i </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">;</span><span style="color:#BABED8;"> i </span><span style="color:#89DDFF;">&lt;</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">1000</span><span style="color:#89DDFF;">;</span><span style="color:#BABED8;"> i</span><span style="color:#89DDFF;">++</span><span style="color:#BABED8;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#BABED8;">rawItems</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">push</span><span style="color:#F07178;">(</span><span style="color:#BABED8;">i</span><span style="color:#F07178;">) </span><span style="color:#676E95;font-style:italic;">// 直接操作原始数组</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>注意：这种方式会直接修改原始数据，需谨慎使用，确保不会破坏响应式系统的完整性。</p><h3 id="_4-处理嵌套对象" tabindex="-1">4. 处理嵌套对象 <a class="header-anchor" href="#_4-处理嵌套对象" aria-hidden="true">#</a></h3><p>对于嵌套的响应式对象，<code>toRaw</code> 也能正确处理：</p><div class="language-javascript line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">reactive</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">toRaw</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">vue</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#BABED8;"> raw </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span><span style="color:#BABED8;"> </span><span style="color:#F07178;">nested</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span><span style="color:#BABED8;"> </span><span style="color:#F07178;">value</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">1</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">}</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#BABED8;"> state </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;"> </span><span style="color:#82AAFF;">reactive</span><span style="color:#BABED8;">(raw)</span></span>
<span class="line"><span style="color:#BABED8;">state</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">nested</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">value </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">2</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#BABED8;"> rawState </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;"> </span><span style="color:#82AAFF;">toRaw</span><span style="color:#BABED8;">(state)</span></span>
<span class="line"><span style="color:#BABED8;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#BABED8;">(rawState</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">nested</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">value) </span><span style="color:#676E95;font-style:italic;">// 2</span></span>
<span class="line"><span style="color:#BABED8;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#BABED8;">(rawState </span><span style="color:#89DDFF;">===</span><span style="color:#BABED8;"> raw) </span><span style="color:#676E95;font-style:italic;">// true</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h2 id="四、使用注意事项" tabindex="-1">四、使用注意事项 <a class="header-anchor" href="#四、使用注意事项" aria-hidden="true">#</a></h2><ol><li><p><strong>不可逆性</strong>：</p><ul><li><code>toRaw</code> 返回的对象是非响应式的，后续修改不会触发视图更新。如果需要保持响应式，应操作原始的 <code>reactive</code> 对象。</li></ul></li><li><p><strong>仅适用于 Vue 的响应式对象</strong>：</p><ul><li>如果传入普通对象，<code>toRaw</code> 直接返回原对象，不会报错，但也没有特殊效果。</li></ul></li><li><p><strong>调试用途</strong>：</p><ul><li>在开发中，<code>toRaw</code> 是调试响应式对象的利器，可以帮助开发者快速定位问题。</li></ul></li></ol><h2 id="五、总结" tabindex="-1">五、总结 <a class="header-anchor" href="#五、总结" aria-hidden="true">#</a></h2><p><code>toRaw</code> 是 Vue 3 提供的一个简单却强大的工具，其源码实现利用了 <code>__v_raw</code> 属性和递归逻辑，优雅地解决了从响应式对象到原始对象的转换问题。在实际项目中，它在与第三方库集成、数据对比、性能优化等场景中都有广泛应用。</p><p>通过理解 <code>toRaw</code> 的原理和使用方法，我们可以更灵活地驾驭 Vue 的响应式系统，编写出更高效、更健壮的代码。希望这篇文章能帮助你更好地掌握这一工具，并在项目中找到它的用武之地！</p>`,41)])])}const B=a(o,[["render",e]]);export{F as __pageData,B as default};
