import{_ as n,o as a,c as l,a as e}from"./app.f86949ad.js";const D=JSON.parse('{"title":"useElementBounding源码解析与使用指南","description":"","frontmatter":{"top":10,"sticky":1000,"sidebar":{"title":"useElementBounding源码解析与使用指南","isTimeLine":true},"title":"useElementBounding源码解析与使用指南","date":"2025-03-31T00:00:00.000Z","tags":["前端","javascript","源码","VueUse"],"categories":["前端"]},"headers":[{"level":2,"title":"VueUse useElementBounding 源码解析与使用指南","slug":"vueuse-useelementbounding-源码解析与使用指南","link":"#vueuse-useelementbounding-源码解析与使用指南","children":[{"level":3,"title":"一、源码结构解析","slug":"一、源码结构解析","link":"#一、源码结构解析","children":[]},{"level":3,"title":"二、关键实现细节","slug":"二、关键实现细节","link":"#二、关键实现细节","children":[]},{"level":3,"title":"三、使用示例","slug":"三、使用示例","link":"#三、使用示例","children":[]},{"level":3,"title":"四、最佳实践与注意事项","slug":"四、最佳实践与注意事项","link":"#四、最佳实践与注意事项","children":[]},{"level":3,"title":"总结","slug":"总结","link":"#总结","children":[]}]}],"relativePath":"VueuseSource/useElementBounding源码解析与使用指南.md","lastUpdated":1764085184000}'),p={name:"VueuseSource/useElementBounding源码解析与使用指南.md"};function o(t,s,r,c,i,y){return a(),l("div",{"data-pagefind-body":!0},[...s[0]||(s[0]=[e(`<hr><h2 id="vueuse-useelementbounding-源码解析与使用指南" tabindex="-1">VueUse useElementBounding 源码解析与使用指南 <a class="header-anchor" href="#vueuse-useelementbounding-源码解析与使用指南" aria-hidden="true">#</a></h2><h3 id="一、源码结构解析" tabindex="-1">一、源码结构解析 <a class="header-anchor" href="#一、源码结构解析" aria-hidden="true">#</a></h3><h4 id="_1-核心函数定义" tabindex="-1">1. 核心函数定义 <a class="header-anchor" href="#_1-核心函数定义" aria-hidden="true">#</a></h4><p><code>useElementBounding</code> 接受两个参数：</p><ul><li><strong>target</strong>：通过 <code>MaybeComputedElementRef</code> 类型支持响应式元素引用（如 <code>ref</code> 或 <code>computed</code> 返回值）</li><li><strong>options</strong>：配置对象，包含重置策略、窗口事件监听等（后文详述）</li></ul><p>返回一个包含 8 个响应式属性和 <code>update</code> 方法的对象：</p><div class="language-typescript line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#FFCB6B;">x</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">ShallowRef</span><span style="color:#89DDFF;">&lt;</span><span style="color:#BABED8;">number</span><span style="color:#89DDFF;">&gt;,</span><span style="color:#F07178;">   </span><span style="color:#676E95;font-style:italic;">// 元素左边界相对视口的 X 坐标</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#FFCB6B;">y</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">ShallowRef</span><span style="color:#89DDFF;">&lt;</span><span style="color:#BABED8;">number</span><span style="color:#89DDFF;">&gt;,</span><span style="color:#F07178;">   </span><span style="color:#676E95;font-style:italic;">// 元素上边界相对视口的 Y 坐标</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#FFCB6B;">top</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">ShallowRef</span><span style="color:#89DDFF;">&lt;</span><span style="color:#BABED8;">number</span><span style="color:#89DDFF;">&gt;,</span><span style="color:#F07178;"> </span><span style="color:#676E95;font-style:italic;">// 元素上边界到文档顶部的距离</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;font-style:italic;">// ...其他边界属性（width/height/left/right/bottom）</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#FFCB6B;">update</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">()</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">void</span><span style="color:#F07178;">       </span><span style="color:#676E95;font-style:italic;">// 手动触发边界计算</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h4 id="_2-实现核心逻辑" tabindex="-1">2. 实现核心逻辑 <a class="header-anchor" href="#_2-实现核心逻辑" aria-hidden="true">#</a></h4><p>源码核心流程如下：</p><ol><li><strong>初始化状态</strong>：通过 <code>window.getBoundingClientRect()</code> 获取初始边界值</li><li><strong>元素监听</strong>： <ul><li>使用 <code>watch</code> 监听 <code>target</code> 变化，自动重新绑定监听器</li><li>通过 <code>useResizeObserver</code> 监听元素尺寸变化触发更新</li></ul></li><li><strong>窗口事件</strong>： <ul><li>根据 <code>windowResize</code> 和 <code>windowScroll</code> 配置，动态绑定 <code>resize</code> 和 <code>scroll</code> 事件</li></ul></li><li><strong>性能优化</strong>： <ul><li>通过 <code>requestAnimationFrame</code> 控制更新频率</li><li>支持 <code>updateTiming: &#39;next-frame&#39;</code> 延迟更新，避免与布局抖动冲突</li></ul></li></ol><hr><h3 id="二、关键实现细节" tabindex="-1">二、关键实现细节 <a class="header-anchor" href="#二、关键实现细节" aria-hidden="true">#</a></h3><h4 id="_1-响应式更新机制" tabindex="-1">1. 响应式更新机制 <a class="header-anchor" href="#_1-响应式更新机制" aria-hidden="true">#</a></h4><div class="language-typescript line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#C792EA;">const</span><span style="color:#BABED8;"> update </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">()</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">el</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">unref</span><span style="color:#F07178;">(</span><span style="color:#BABED8;">target</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;"> (</span><span style="color:#89DDFF;">!</span><span style="color:#BABED8;">el</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;font-style:italic;">return</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">rect</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">el</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">getBoundingClientRect</span><span style="color:#F07178;">()</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#BABED8;">x</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">value</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">rect</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">x</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#BABED8;">y</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">value</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">rect</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">y</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;font-style:italic;">// ...其他属性更新</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>每次更新触发 <code>getBoundingClientRect()</code>，但通过 <code>ShallowRef</code> 优化引用类型性能</p><h4 id="_2-生命周期管理" tabindex="-1">2. 生命周期管理 <a class="header-anchor" href="#_2-生命周期管理" aria-hidden="true">#</a></h4><ul><li><strong>卸载重置</strong>：当 <code>options.reset=true</code> 时，组件卸载后所有属性归零</li><li><strong>事件解绑</strong>：自动清理 <code>resize</code>/<code>scroll</code> 监听器，避免内存泄漏</li></ul><h4 id="_3-配置项详解" tabindex="-1">3. 配置项详解 <a class="header-anchor" href="#_3-配置项详解" aria-hidden="true">#</a></h4><table><thead><tr><th>选项</th><th>默认值</th><th>说明</th></tr></thead><tbody><tr><td><code>reset</code></td><td>true</td><td>组件卸载时重置边界值为 0</td></tr><tr><td><code>windowResize</code></td><td>true</td><td>监听窗口 resize 事件</td></tr><tr><td><code>windowScroll</code></td><td>true</td><td>监听窗口 scroll 事件</td></tr><tr><td><code>immediate</code></td><td>true</td><td>初始化立即计算边界</td></tr><tr><td><code>updateTiming</code></td><td>&#39;sync&#39;</td><td>更新时机（&#39;sync&#39; 立即 / &#39;next-frame&#39; 下一帧）</td></tr></tbody></table><hr><h3 id="三、使用示例" tabindex="-1">三、使用示例 <a class="header-anchor" href="#三、使用示例" aria-hidden="true">#</a></h3><h4 id="_1-基础用法" tabindex="-1">1. 基础用法 <a class="header-anchor" href="#_1-基础用法" aria-hidden="true">#</a></h4><div class="language-vue line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">vue</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">template</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">div</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">ref</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">targetEl</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">&gt;</span><span style="color:#BABED8;">可拖拽元素</span><span style="color:#89DDFF;">&lt;/</span><span style="color:#F07178;">div</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">p</span><span style="color:#89DDFF;">&gt;</span><span style="color:#BABED8;">宽度：{{ width }}</span><span style="color:#89DDFF;">&lt;/</span><span style="color:#F07178;">p</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#89DDFF;">&lt;/</span><span style="color:#F07178;">template</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">script</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">setup</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">ref</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">vue</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">useElementBounding</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">@vueuse/core</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#C792EA;">const</span><span style="color:#BABED8;"> targetEl </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;"> </span><span style="color:#82AAFF;">ref</span><span style="color:#BABED8;">(</span><span style="color:#89DDFF;">null</span><span style="color:#BABED8;">)</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#C792EA;">const</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span><span style="color:#BABED8;"> width</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;"> height</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;"> update </span><span style="color:#89DDFF;">}</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;"> </span><span style="color:#82AAFF;">useElementBounding</span><span style="color:#BABED8;">(targetEl</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#F07178;">windowScroll</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FF9CAC;">false</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;"> </span><span style="color:#676E95;font-style:italic;">// 禁用滚动监听</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#89DDFF;">}</span><span style="color:#BABED8;">)</span></span>
<span class="line"><span style="color:#89DDFF;">&lt;/</span><span style="color:#F07178;">script</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><h4 id="_2-组件式用法" tabindex="-1">2. 组件式用法 <a class="header-anchor" href="#_2-组件式用法" aria-hidden="true">#</a></h4><div class="language-vue line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">vue</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">UseElementBounding</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">v-slot</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">x</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">y</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#BABED8;">  当前位置：{{ x }}, {{ y }}</span></span>
<span class="line"><span style="color:#89DDFF;">&lt;/</span><span style="color:#F07178;">UseElementBounding</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h4 id="_3-指令式用法" tabindex="-1">3. 指令式用法 <a class="header-anchor" href="#_3-指令式用法" aria-hidden="true">#</a></h4><div class="language-vue line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">vue</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">template</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">div</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">v-element-bounding</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">handleBoundingUpdate</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">&gt;&lt;/</span><span style="color:#F07178;">div</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#89DDFF;">&lt;/</span><span style="color:#F07178;">template</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">script</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">setup</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#C792EA;">function</span><span style="color:#BABED8;"> </span><span style="color:#82AAFF;">handleBoundingUpdate</span><span style="color:#89DDFF;">({</span><span style="color:#BABED8;"> </span><span style="color:#BABED8;font-style:italic;">width</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;"> </span><span style="color:#BABED8;font-style:italic;">height</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">})</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#BABED8;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">新尺寸:</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">width</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">height</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">&lt;/</span><span style="color:#F07178;">script</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><hr><h3 id="四、最佳实践与注意事项" tabindex="-1">四、最佳实践与注意事项 <a class="header-anchor" href="#四、最佳实践与注意事项" aria-hidden="true">#</a></h3><ol><li><strong>性能敏感场景</strong>建议关闭 <code>windowScroll</code>，改用 <code>IntersectionObserver</code></li><li><strong>动态元素</strong>需配合 <code>watch</code> 监听元素引用变化：</li></ol><div class="language-javascript line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#82AAFF;">watch</span><span style="color:#BABED8;">(targetEl</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;"> </span><span style="color:#BABED8;font-style:italic;">newEl</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;"> (</span><span style="color:#BABED8;">newEl</span><span style="color:#F07178;">) </span><span style="color:#82AAFF;">update</span><span style="color:#F07178;">()</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#BABED8;">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><ol start="3"><li><strong>SSR 兼容</strong>：通过 <code>import { maybeElementRef } from &#39;@vueuse/core&#39;</code> 处理服务端渲染</li><li><strong>TypeScript 支持</strong>：完整类型声明见 <code>@vueuse/core</code> 的类型定义文件</li></ol><hr><h3 id="总结" tabindex="-1">总结 <a class="header-anchor" href="#总结" aria-hidden="true">#</a></h3><p><code>useElementBounding</code> 通过智能的事件绑定和响应式更新机制，将原生 <code>getBoundingClientRect</code> 转化为易用的 Composition API。其源码实现体现了 VueUse 对性能优化和开发体验的深度思考，是学习 Vue 响应式设计与浏览器 API 集成的优秀范例。</p>`,36)])])}const d=n(p,[["render",o]]);export{D as __pageData,d as default};
