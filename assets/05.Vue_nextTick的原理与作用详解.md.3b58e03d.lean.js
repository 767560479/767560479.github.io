import{_ as n,o as a,c as l,a as p}from"./app.f86949ad.js";const D=JSON.parse('{"title":"nextTick的原理与作用详解","description":"","frontmatter":{"top":110,"sticky":1000,"sidebar":{"title":"nextTick的原理与作用详解","isTimeLine":true},"title":"nextTick的原理与作用详解","date":"2025-07-03T00:00:00.000Z","tags":["前端","javascript","Vue3"],"categories":["前端"]},"headers":[{"level":3,"title":"Vue 中 nextTick 的原理与作用详解","slug":"vue-中-nexttick-的原理与作用详解","link":"#vue-中-nexttick-的原理与作用详解","children":[]}],"relativePath":"05.Vue/nextTick的原理与作用详解.md","lastUpdated":1764085184000}'),o={name:"05.Vue/nextTick的原理与作用详解.md"};function e(t,s,c,r,i,F){return a(),l("div",{"data-pagefind-body":!0},[...s[0]||(s[0]=[p(`<hr><h3 id="vue-中-nexttick-的原理与作用详解" tabindex="-1">Vue 中 <code>nextTick</code> 的原理与作用详解 <a class="header-anchor" href="#vue-中-nexttick-的原理与作用详解" aria-hidden="true">#</a></h3><p><code>nextTick</code> 是 Vue 的核心异步调度机制，用于在 <strong>DOM 更新后执行回调</strong>，解决数据更新与 DOM 渲染异步性导致的操作时序问题。以下从原理、实现、应用及对比四个方面深入解析。</p><hr><h4 id="一、核心原理-事件循环与异步更新" tabindex="-1">一、核心原理：事件循环与异步更新 <a class="header-anchor" href="#一、核心原理-事件循环与异步更新" aria-hidden="true">#</a></h4><ol><li><p><strong>Vue 的异步更新机制</strong></p><ul><li>数据变化时，Vue 不会立即更新 DOM，而是将变更推入<strong>异步队列</strong>（<code>queueWatcher</code>），合并同一事件循环内的多次数据修改，避免重复渲染（性能优化关键）。</li><li>例如，循环修改数据 <code>100</code> 次仅触发一次视图更新。</li></ul></li><li><p><strong>事件循环（Event Loop）的利用</strong></p><ul><li><code>nextTick</code> 将回调函数包装为微任务（microTask）或宏任务（macroTask），插入事件循环： <ul><li><strong>微任务优先级更高</strong>：默认使用 <code>Promise.then</code> 或 <code>MutationObserver</code>，在当前同步任务结束后、页面渲染前执行。</li><li><strong>宏任务降级</strong>：不支持微任务时，降级为 <code>setImmediate</code> 或 <code>setTimeout</code>，延迟至下一轮事件循环执行。</li></ul></li></ul></li><li><p><strong>执行流程</strong></p><div class="language-mermaid line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">mermaid</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#89DDFF;font-style:italic;">graph</span><span style="color:#BABED8;"> </span><span style="color:#82AAFF;">LR</span></span>
<span class="line"><span style="color:#BABED8;">A</span><span style="color:#89DDFF;font-style:italic;">[</span><span style="color:#C3E88D;">数据变更</span><span style="color:#89DDFF;font-style:italic;">]</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;font-style:italic;">--&gt;</span><span style="color:#BABED8;"> B</span><span style="color:#89DDFF;font-style:italic;">[</span><span style="color:#C3E88D;">异步队列 queueWatcher</span><span style="color:#89DDFF;font-style:italic;">]</span></span>
<span class="line"><span style="color:#BABED8;">B </span><span style="color:#89DDFF;font-style:italic;">--&gt;</span><span style="color:#BABED8;"> C</span><span style="color:#89DDFF;font-style:italic;">[</span><span style="color:#C3E88D;">nextTick</span><span style="color:#BABED8;">(</span><span style="color:#C3E88D;">flushSchedulerQueue</span><span style="color:#89DDFF;font-style:italic;">)]</span></span>
<span class="line"><span style="color:#BABED8;">C </span><span style="color:#89DDFF;font-style:italic;">--&gt;</span><span style="color:#BABED8;"> D</span><span style="color:#89DDFF;font-style:italic;">[</span><span style="color:#C3E88D;">回调推入 callbacks 数组</span><span style="color:#89DDFF;font-style:italic;">]</span></span>
<span class="line"><span style="color:#BABED8;">D </span><span style="color:#89DDFF;font-style:italic;">--&gt;</span><span style="color:#BABED8;"> E</span><span style="color:#89DDFF;font-style:italic;">{</span><span style="color:#C3E88D;">微任务支持</span><span style="color:#BABED8;">？</span><span style="color:#89DDFF;font-style:italic;">}</span></span>
<span class="line"><span style="color:#BABED8;">E </span><span style="color:#89DDFF;font-style:italic;">--&gt;|</span><span style="color:#C3E88D;">是</span><span style="color:#89DDFF;font-style:italic;">|</span><span style="color:#BABED8;"> F</span><span style="color:#89DDFF;font-style:italic;">[</span><span style="color:#C3E88D;">MicroTask</span><span style="color:#BABED8;">：</span><span style="color:#C3E88D;">Promise/MutationObserver</span><span style="color:#89DDFF;font-style:italic;">]</span></span>
<span class="line"><span style="color:#BABED8;">E </span><span style="color:#89DDFF;font-style:italic;">--&gt;|</span><span style="color:#C3E88D;">否</span><span style="color:#89DDFF;font-style:italic;">|</span><span style="color:#BABED8;"> G</span><span style="color:#89DDFF;font-style:italic;">[</span><span style="color:#C3E88D;">MacroTask</span><span style="color:#BABED8;">：</span><span style="color:#C3E88D;">setImmediate/setTimeout</span><span style="color:#89DDFF;font-style:italic;">]</span></span>
<span class="line"><span style="color:#BABED8;">F &amp; G </span><span style="color:#89DDFF;font-style:italic;">--&gt;</span><span style="color:#BABED8;"> H</span><span style="color:#89DDFF;font-style:italic;">[</span><span style="color:#C3E88D;">执行回调</span><span style="color:#BABED8;">，</span><span style="color:#C3E88D;">更新 DOM</span><span style="color:#89DDFF;font-style:italic;">]</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div></li></ol><hr><h4 id="二、实现机制-源码级解析" tabindex="-1">二、实现机制：源码级解析 <a class="header-anchor" href="#二、实现机制-源码级解析" aria-hidden="true">#</a></h4><ol><li><p><strong>回调管理</strong></p><ul><li>所有 <code>nextTick</code> 回调存入数组 <code>callbacks</code>，通过 <code>pending</code> 标志位控制异步任务仅触发一次：</li></ul><div class="language-javascript line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#C792EA;">const</span><span style="color:#BABED8;"> callbacks </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;"> [] </span><span style="color:#676E95;font-style:italic;">// 回调队列</span></span>
<span class="line"><span style="color:#C792EA;">let</span><span style="color:#BABED8;"> pending </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;"> </span><span style="color:#FF9CAC;">false</span><span style="color:#BABED8;"> </span><span style="color:#676E95;font-style:italic;">// 状态锁</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">function</span><span style="color:#BABED8;"> </span><span style="color:#82AAFF;">nextTick</span><span style="color:#89DDFF;">(</span><span style="color:#BABED8;font-style:italic;">cb</span><span style="color:#89DDFF;">)</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#BABED8;">callbacks</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">push</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">()</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">cb</span><span style="color:#F07178;">()) </span><span style="color:#676E95;font-style:italic;">// 回调入队</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;"> (</span><span style="color:#89DDFF;">!</span><span style="color:#BABED8;">pending</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#BABED8;">pending</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#FF9CAC;">true</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#82AAFF;">timerFunc</span><span style="color:#F07178;">() </span><span style="color:#676E95;font-style:italic;">// 触发异步调度</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div></li><li><p><strong>异步降级策略</strong>（<code>timerFunc</code> 实现）<br> Vue 根据浏览器兼容性选择异步方案，优先级如下：</p><ul><li><strong>微任务</strong>： <ul><li><code>Promise.then</code> → <code>MutationObserver</code>（监听 DOM 变动）</li></ul></li><li><strong>宏任务</strong>： <ul><li><code>setImmediate</code> → <code>MessageChannel</code> → <code>setTimeout</code></li></ul></li></ul><div class="language-javascript line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#BABED8;"> (支持 </span><span style="color:#FFCB6B;">Promise</span><span style="color:#BABED8;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#82AAFF;">timerFunc</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">()</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> </span><span style="color:#FFCB6B;">Promise</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">resolve</span><span style="color:#F07178;">()</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">then</span><span style="color:#F07178;">(</span><span style="color:#BABED8;">flushCallbacks</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;font-style:italic;">else</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#BABED8;"> (支持 MutationObserver) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">observer</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">new</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">MutationObserver</span><span style="color:#F07178;">(</span><span style="color:#BABED8;">flushCallbacks</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">textNode</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">document</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">createTextNode</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">1</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#BABED8;">observer</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">observe</span><span style="color:#F07178;">(</span><span style="color:#BABED8;">textNode</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> characterData</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#FF9CAC;">true</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#82AAFF;">timerFunc</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">()</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">textNode</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">data</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">2</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">;</span><span style="color:#F07178;"> </span><span style="color:#676E95;font-style:italic;">// 触发回调</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;font-style:italic;">else</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#82AAFF;">timerFunc</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">()</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">setTimeout</span><span style="color:#F07178;">(</span><span style="color:#BABED8;">flushCallbacks</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">0</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span><span style="color:#F07178;"> </span><span style="color:#676E95;font-style:italic;">// 降级</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div></li><li><p><strong>回调执行</strong><br><code>flushCallbacks</code> 复制当前回调队列并清空，防止递归调用导致无限循环：</p><div class="language-javascript line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#C792EA;">function</span><span style="color:#BABED8;"> </span><span style="color:#82AAFF;">flushCallbacks</span><span style="color:#89DDFF;">()</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#BABED8;">pending</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#FF9CAC;">false</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">copies</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">callbacks</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">slice</span><span style="color:#F07178;">(</span><span style="color:#F78C6C;">0</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#BABED8;">callbacks</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">length</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">0</span><span style="color:#F07178;"> </span><span style="color:#676E95;font-style:italic;">// 清空原队列</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;font-style:italic;">for</span><span style="color:#F07178;"> (</span><span style="color:#C792EA;">let</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">i</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">;</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">i</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">copies</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">length</span><span style="color:#89DDFF;">;</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">i</span><span style="color:#89DDFF;">++</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#BABED8;">copies</span><span style="color:#F07178;">[</span><span style="color:#BABED8;">i</span><span style="color:#F07178;">]() </span><span style="color:#676E95;font-style:italic;">// 执行回调</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div></li></ol><hr><h4 id="三、核心作用与应用场景" tabindex="-1">三、核心作用与应用场景 <a class="header-anchor" href="#三、核心作用与应用场景" aria-hidden="true">#</a></h4><ol><li><p><strong>解决 DOM 更新后操作问题</strong></p><ul><li><strong>问题</strong>：数据修改后直接操作 DOM 可能获取旧状态（如获取元素尺寸、焦点）。</li><li><strong>方案</strong>：将 DOM 操作放入 <code>nextTick</code> 回调，确保基于更新后的 DOM 执行：</li></ul><div class="language-vue line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">vue</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">template</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">input</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">ref</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">input</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">v-if</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">showInput</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;"> /&gt;</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">button</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">@click</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">showAndFocus</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">&gt;</span><span style="color:#BABED8;">显示并聚焦</span><span style="color:#89DDFF;">&lt;/</span><span style="color:#F07178;">button</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#89DDFF;">&lt;/</span><span style="color:#F07178;">template</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">script</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;font-style:italic;">default</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#F07178;">methods</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#BABED8;">      </span><span style="color:#F07178;">showAndFocus</span><span style="color:#89DDFF;">()</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;">this.</span><span style="color:#BABED8;">showInput</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#FF9CAC;">true</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;">this.</span><span style="color:#82AAFF;">$nextTick</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">()</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">          </span><span style="color:#89DDFF;">this.</span><span style="color:#BABED8;">$refs</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">input</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">focus</span><span style="color:#F07178;">() </span><span style="color:#676E95;font-style:italic;">// DOM 渲染完成后再聚焦</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">&lt;/</span><span style="color:#F07178;">script</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div></li><li><p><strong>获取更新后的视图状态</strong></p><ul><li>在数据修改后立即获取属性（如列表长度）需通过 <code>nextTick</code>：</li></ul><div class="language-javascript line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#89DDFF;">this.</span><span style="color:#BABED8;">list</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">push</span><span style="color:#BABED8;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">newItem</span><span style="color:#89DDFF;">&#39;</span><span style="color:#BABED8;">)</span></span>
<span class="line"><span style="color:#BABED8;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#BABED8;">(</span><span style="color:#89DDFF;">this.</span><span style="color:#BABED8;">$refs</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">list</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">children</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">length) </span><span style="color:#676E95;font-style:italic;">// 旧长度</span></span>
<span class="line"><span style="color:#89DDFF;">this.</span><span style="color:#82AAFF;">$nextTick</span><span style="color:#BABED8;">(</span><span style="color:#89DDFF;">()</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#BABED8;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">this.</span><span style="color:#BABED8;">$refs</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">list</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">children</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">length</span><span style="color:#F07178;">) </span><span style="color:#676E95;font-style:italic;">// 新长度</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#BABED8;">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div></li><li><p><strong>与第三方库整合</strong></p><ul><li>在 <code>created</code> 生命周期操作 DOM 时（如初始化图表库），需等待模板渲染完成：</li></ul><div class="language-javascript line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#82AAFF;">created</span><span style="color:#BABED8;">() </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">this.</span><span style="color:#82AAFF;">$nextTick</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">()</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#82AAFF;">initChart</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">this.</span><span style="color:#BABED8;">$el</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span><span style="color:#F07178;"> </span><span style="color:#676E95;font-style:italic;">// DOM 已生成</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div></li></ol><hr><h4 id="四、对比与注意事项" tabindex="-1">四、对比与注意事项 <a class="header-anchor" href="#四、对比与注意事项" aria-hidden="true">#</a></h4><ol><li><p><strong>与 <code>setTimeout</code> 的区别</strong></p><table><thead><tr><th><strong>特性</strong></th><th><code>nextTick</code></th><th><code>setTimeout</code></th></tr></thead><tbody><tr><td><strong>执行时机</strong></td><td>微任务（优先）</td><td>宏任务（延迟）</td></tr><tr><td><strong>与渲染关系</strong></td><td>DOM 更新后、渲染前执行</td><td>渲染后执行</td></tr><tr><td><strong>性能影响</strong></td><td>更低延迟，避免页面抖动</td><td>可能导致布局延迟</td></tr></tbody></table></li><li><p><strong>与 Node.js <code>process.nextTick</code></strong></p><ul><li><strong>Vue</strong>：针对浏览器 DOM 更新设计，依赖事件循环。</li><li><strong>Node.js</strong>：在事件循环当前阶段末尾执行，与 DOM 无关。</li></ul></li><li><p><strong>避免滥用</strong></p><ul><li>多次调用 <code>nextTick</code> 会合并回调，但频繁操作仍可能阻塞渲染。</li><li>优先使用计算属性（<code>computed</code>）或侦听器（<code>watch</code>）响应数据变化，减少直接 DOM 操作。</li></ul></li></ol><hr><h4 id="总结" tabindex="-1">总结 <a class="header-anchor" href="#总结" aria-hidden="true">#</a></h4><ul><li><strong>核心价值</strong>：<code>nextTick</code> 通过<strong>异步队列+事件循环调度</strong>，解决数据到 DOM 更新的延迟问题，是 Vue 响应式系统的关键补充。</li><li><strong>开发建议</strong>： <ul><li>在 <code>created</code> 或数据更新后需操作 DOM 时使用；</li><li>优先选择微任务方案（现代浏览器）；</li><li>结合 <code>async/await</code> 提升代码可读性：</li></ul><div class="language-javascript line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#BABED8;">async </span><span style="color:#82AAFF;">updateData</span><span style="color:#BABED8;">() </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">this.</span><span style="color:#BABED8;">value</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">new</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;font-style:italic;">await</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">this.</span><span style="color:#82AAFF;">$nextTick</span><span style="color:#F07178;">()</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#BABED8;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">DOM updated!</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div></li></ul>`,18)])])}const d=n(o,[["render",e]]);export{D as __pageData,d as default};
